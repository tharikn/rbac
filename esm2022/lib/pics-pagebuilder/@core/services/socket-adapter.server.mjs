import { Injectable } from '@angular/core';
import { Observable } from 'rxjs';
import * as i0 from "@angular/core";
import * as i1 from "@angular/router";
import * as i2 from "./local.service";
export class SocketAdapterService {
    router;
    localstorage;
    socketOption = {
        query: null,
        transports: ['websocket'],
        reconnection: true,
        reconnectionDelay: 1000,
        reconnectionDelayMax: 5000,
        reconnectionAttempts: 20
        // agent: false,
        // upgrade: false,
        // rejectUnauthorized: false,
        // secure: true,
        // pingTimeout: 60000,
        // autoConnect: true
    };
    // private url = environment.chatServer;
    socket;
    constructor(router, localstorage) {
        this.router = router;
        this.localstorage = localstorage;
        console.log('Constructing Socket IO');
        this.router.events.subscribe(() => {
            const user = this.localstorage.getObj('user');
            if (user && this.socketOption.query == null) {
                this.socketOption = {
                    ...this.socketOption,
                    query: {
                        userId: user?.id
                    }
                };
                // this.socket = io(this.url, this.socketOption);
                console.log(this.socket);
            }
        });
    }
    joinRoom(roomData) {
        console.log('Socket joining room : ', roomData);
        this.socket.emit('joinRoom', roomData);
    }
    leaveRoom(roomData) {
        console.log('Socket leaving room: ', roomData);
        this.socket.emit('leaveRoom', roomData);
    }
    onConnect() {
        console.log('Socket On Connect');
        return new Observable(observer => {
            this.socket.on('connect', () => {
                console.log('Socket new connect...');
                observer.next('connectd');
            });
            return () => {
                this.socket.disconnect();
            };
        });
    }
    onReConnect() {
        return new Observable(observer => {
            this.socket.on('reconnect', () => {
                observer.next('connectd');
            });
            return () => {
                this.socket.disconnect();
            };
        });
    }
    receivePageData() {
        return new Observable(observer => {
            this.socket.on('receive_page_data', (data) => {
                observer.next(data);
            });
            return () => {
                this.socket.disconnect();
            };
        });
    }
    onlineEditPageUsers() {
        return new Observable(observer => {
            this.socket.on('online_edit_page_user', (data) => {
                observer.next(data);
            });
            return () => {
                this.socket.disconnect();
            };
        });
    }
    sendPageData(payload) {
        console.log('Sending page data');
        console.log(payload);
        this.socket.emit('send_page_data', payload);
    }
    static ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: SocketAdapterService, deps: [{ token: i1.Router }, { token: i2.LocalService }], target: i0.ɵɵFactoryTarget.Injectable });
    static ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: SocketAdapterService, providedIn: 'root' });
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.2.12", ngImport: i0, type: SocketAdapterService, decorators: [{
            type: Injectable,
            args: [{
                    providedIn: 'root'
                }]
        }], ctorParameters: function () { return [{ type: i1.Router }, { type: i2.LocalService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic29ja2V0LWFkYXB0ZXIuc2VydmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvcGljcy1tb2R1bGUvcGFnZS1idWlsZGVyL3NyYy9saWIvcGljcy1wYWdlYnVpbGRlci9AY29yZS9zZXJ2aWNlcy9zb2NrZXQtYWRhcHRlci5zZXJ2ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sTUFBTSxDQUFDOzs7O0FBVWxDLE1BQU0sT0FBTyxvQkFBb0I7SUFrQlo7SUFBdUI7SUFqQmxDLFlBQVksR0FBRztRQUNyQixLQUFLLEVBQUUsSUFBSTtRQUNYLFVBQVUsRUFBRSxDQUFDLFdBQVcsQ0FBQztRQUN6QixZQUFZLEVBQUUsSUFBSTtRQUNsQixpQkFBaUIsRUFBRSxJQUFJO1FBQ3ZCLG9CQUFvQixFQUFFLElBQUk7UUFDMUIsb0JBQW9CLEVBQUUsRUFBRTtRQUN4QixnQkFBZ0I7UUFDaEIsa0JBQWtCO1FBQ2xCLDZCQUE2QjtRQUM3QixnQkFBZ0I7UUFDaEIsc0JBQXNCO1FBQ3RCLG9CQUFvQjtLQUNyQixDQUFDO0lBQ0Ysd0NBQXdDO0lBQ2pDLE1BQU0sQ0FBUztJQUV0QixZQUFtQixNQUFjLEVBQVMsWUFBMEI7UUFBakQsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUFTLGlCQUFZLEdBQVosWUFBWSxDQUFjO1FBQ2xFLE9BQU8sQ0FBQyxHQUFHLENBQUMsd0JBQXdCLENBQUMsQ0FBQztRQUN0QyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFO1lBQ2hDLE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzlDLElBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxZQUFZLENB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QUFtQixDQUFDLENBQUM7UUFDakMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNyQixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxPQUFPLENBQUMsQ0FBQztJQUM5QyxDQUFDO3dHQTVGVSxvQkFBb0I7NEdBQXBCLG9CQUFvQixjQUZuQixNQUFNOzs0RkFFUCxvQkFBb0I7a0JBSGhDLFVBQVU7bUJBQUM7b0JBQ1YsVUFBVSxFQUFFLE1BQU07aUJBQ25CIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XHJcbmltcG9ydCB7IGlvLCBTb2NrZXQgfSBmcm9tICdzb2NrZXQuaW8tY2xpZW50JztcclxuLy8gaW1wb3J0IHsgTG9jYWxTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvbG9jYWwuc2VydmljZSc7XHJcbi8vIGltcG9ydCB7IGVudmlyb25tZW50IH0gZnJvbSAnc3JjL2Vudmlyb25tZW50cy9lbnZpcm9ubWVudCc7XHJcbmltcG9ydCB7IFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XHJcbmltcG9ydCB7IExvY2FsU2VydmljZSB9IGZyb20gJy4vbG9jYWwuc2VydmljZSc7XHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBTb2NrZXRBZGFwdGVyU2VydmljZSB7XHJcbiAgcHJpdmF0ZSBzb2NrZXRPcHRpb24gPSB7XHJcbiAgICBxdWVyeTogbnVsbCxcclxuICAgIHRyYW5zcG9ydHM6IFsnd2Vic29ja2V0J10sXHJcbiAgICByZWNvbm5lY3Rpb246IHRydWUsXHJcbiAgICByZWNvbm5lY3Rpb25EZWxheTogMTAwMCxcclxuICAgIHJlY29ubmVjdGlvbkRlbGF5TWF4OiA1MDAwLFxyXG4gICAgcmVjb25uZWN0aW9uQXR0ZW1wdHM6IDIwXHJcbiAgICAvLyBhZ2VudDogZmFsc2UsXHJcbiAgICAvLyB1cGdyYWRlOiBmYWxzZSxcclxuICAgIC8vIHJlamVjdFVuYXV0aG9yaXplZDogZmFsc2UsXHJcbiAgICAvLyBzZWN1cmU6IHRydWUsXHJcbiAgICAvLyBwaW5nVGltZW91dDogNjAwMDAsXHJcbiAgICAvLyBhdXRvQ29ubmVjdDogdHJ1ZVxyXG4gIH07XHJcbiAgLy8gcHJpdmF0ZSB1cmwgPSBlbnZpcm9ubWVudC5jaGF0U2VydmVyO1xyXG4gIHB1YmxpYyBzb2NrZXQ6IFNvY2tldDtcclxuXHJcbiAgY29uc3RydWN0b3IocHVibGljIHJvdXRlcjogUm91dGVyLCBwdWJsaWMgbG9jYWxzdG9yYWdlOiBMb2NhbFNlcnZpY2UpIHtcclxuICAgIGNvbnNvbGUubG9nKCdDb25zdHJ1Y3RpbmcgU29ja2V0IElPJyk7XHJcbiAgICB0aGlzLnJvdXRlci5ldmVudHMuc3Vic2NyaWJlKCgpID0+IHtcclxuICAgICAgY29uc3QgdXNlciA9IHRoaXMubG9jYWxzdG9yYWdlLmdldE9iaigndXNlcicpO1xyXG4gICAgICBpZiAodXNlciAmJiB0aGlzLnNvY2tldE9wdGlvbi5xdWVyeSA9PSBudWxsKSB7XHJcbiAgICAgICAgdGhpcy5zb2NrZXRPcHRpb24gPSB7XHJcbiAgICAgICAgICAuLi50aGlzLnNvY2tldE9wdGlvbixcclxuICAgICAgICAgIHF1ZXJ5OiB7XHJcbiAgICAgICAgICAgIHVzZXJJZDogdXNlcj8uaWRcclxuICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIC8vIHRoaXMuc29ja2V0ID0gaW8odGhpcy51cmwsIHRoaXMuc29ja2V0T3B0aW9uKTtcclxuICAgICAgICBjb25zb2xlLmxvZyh0aGlzLnNvY2tldCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgam9pblJvb20ocm9vbURhdGE6IGFueSkge1xyXG4gICAgY29uc29sZS5sb2coJ1NvY2tldCBqb2luaW5nIHJvb20gOiAnLCByb29tRGF0YSk7XHJcbiAgICB0aGlzLnNvY2tldC5lbWl0KCdqb2luUm9vbScsIHJvb21EYXRhKTtcclxuICB9XHJcblxyXG4gIGxlYXZlUm9vbShyb29tRGF0YTogYW55KSB7XHJcbiAgICBjb25zb2xlLmxvZygnU29ja2V0IGxlYXZpbmcgcm9vbTogJywgcm9vbURhdGEpO1xyXG4gICAgdGhpcy5zb2NrZXQuZW1pdCgnbGVhdmVSb29tJywgcm9vbURhdGEpO1xyXG4gIH1cclxuICBvbkNvbm5lY3QoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIGNvbnNvbGUubG9nKCdTb2NrZXQgT24gQ29ubmVjdCcpO1xyXG4gICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKG9ic2VydmVyID0+IHtcclxuICAgICAgdGhpcy5zb2NrZXQub24oJ2Nvbm5lY3QnLCAoKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1NvY2tldCBuZXcgY29ubmVjdC4uLicpO1xyXG4gICAgICAgIG9ic2VydmVyLm5leHQoJ2Nvbm5lY3RkJyk7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuc29ja2V0LmRpc2Nvbm5lY3QoKTtcclxuICAgICAgfTtcclxuICAgIH0pO1xyXG4gIH1cclxuICBvblJlQ29ubmVjdCgpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKG9ic2VydmVyID0+IHtcclxuICAgICAgdGhpcy5zb2NrZXQub24oJ3JlY29ubmVjdCcsICgpID0+IHtcclxuICAgICAgICBvYnNlcnZlci5uZXh0KCdjb25uZWN0ZCcpO1xyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuICgpID0+IHtcclxuICAgICAgICB0aGlzLnNvY2tldC5kaXNjb25uZWN0KCk7XHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuICB9XHJcbiAgcmVjZWl2ZVBhZ2VEYXRhKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICByZXR1cm4gbmV3IE9ic2VydmFibGUob2JzZXJ2ZXIgPT4ge1xyXG4gICAgICB0aGlzLnNvY2tldC5vbigncmVjZWl2ZV9wYWdlX2RhdGEnLCAoZGF0YTogYW55KSA9PiB7XHJcbiAgICAgICAgb2JzZXJ2ZXIubmV4dChkYXRhKTtcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiAoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5zb2NrZXQuZGlzY29ubmVjdCgpO1xyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBvbmxpbmVFZGl0UGFnZVVzZXJzKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICByZXR1cm4gbmV3IE9ic2VydmFibGUob2JzZXJ2ZXIgPT4ge1xyXG4gICAgICB0aGlzLnNvY2tldC5vbignb25saW5lX2VkaXRfcGFnZV91c2VyJywgKGRhdGE6IGFueSkgPT4ge1xyXG4gICAgICAgIG9ic2VydmVyLm5leHQoZGF0YSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuc29ja2V0LmRpc2Nvbm5lY3QoKTtcclxuICAgICAgfTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgc2VuZFBhZ2VEYXRhKHBheWxvYWQpIHtcclxuICAgIGNvbnNvbGUubG9nKCdTZW5kaW5nIHBhZ2UgZGF0YScpO1xyXG4gICAgY29uc29sZS5sb2cocGF5bG9hZCk7XHJcbiAgICB0aGlzLnNvY2tldC5lbWl0KCdzZW5kX3BhZ2VfZGF0YScsIHBheWxvYWQpO1xyXG4gIH1cclxuXHJcbiAgLy8gc2VuZE1lc3NhZ2UocGFyYW06IGFueSkge1xyXG4gIC8vICAgdGhpcy5zb2NrZXQuZW1pdCgnc2VuZF9tZXNzYWdlJywgcGFyYW0pO1xyXG4gIC8vIH1cclxuXHJcbiAgLy8gY29ubmVjdCgpIHtcclxuICAvLyAgIGNvbnNvbGUubG9nKCdTb2NrZXQgQ29ubmVjdGluZy4uLicsIHRoaXMudXJsLCB0aGlzLnNvY2tldE9wdGlvbik7XHJcbiAgLy8gICB0aGlzLnNvY2tldCA9IGlvKHRoaXMudXJsLCB0aGlzLnNvY2tldE9wdGlvbik7XHJcbiAgLy8gICBjb25zb2xlLmxvZygnQWZ0ZXIgU29ja2V0IENvbm5lY3RpbmcuLi4nKTtcclxuXHJcbiAgLy8gICBjb25zb2xlLmxvZyh0aGlzLnNvY2tldCk7XHJcbiAgLy8gICByZXR1cm4gdGhpcy5zb2NrZXQ7XHJcbiAgLy8gfVxyXG5cclxuICAvLyBkaXNjb25uZWN0KCkge1xyXG4gIC8vICAgaWYgKCEhdGhpcy5zb2NrZXQpIHtcclxuICAvLyAgICAgdGhpcy5zb2NrZXQuZGlzY29ubmVjdCgpO1xyXG4gIC8vICAgfVxyXG4gIC8vIH1cclxuXHJcblxyXG5cclxuICAvKmNoYXQgU29ja2V0IHN0YXJ0cyovXHJcblxyXG4gIC8vIHNlbmRQcml2YXRlTWVzc2FnZShtZXNzYWdlKSB7XHJcbiAgLy8gICB0aGlzLnNvY2tldC5lbWl0KCdzZW5kLXByaXZhdGUtbWVzc2FnZScsIG1lc3NhZ2UpO1xyXG4gIC8vIH1cclxuXHJcbiAgLy8gZ2V0VXNlclNlc3Npb24oKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAvLyAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZShvYnNlcnZlciA9PiB7XHJcbiAgLy8gICAgIHRoaXMuc29ja2V0Lm9uKCdnZXQtdXNlci1zZXNzaW9ucycsIChkYXRhOiBhbnkpID0+IHtcclxuICAvLyAgICAgICBvYnNlcnZlci5uZXh0KGRhdGEpO1xyXG4gIC8vICAgICB9KTtcclxuICAvLyAgICAgcmV0dXJuICgpID0+IHtcclxuICAvLyAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdzb2NrZXRFcnJvcktleScsICdHU1MnKTtcclxuICAvLyAgICAgICAvLyB0aGlzLnNvY2tldC5kaXNjb25uZWN0KCk7XHJcbiAgLy8gICAgIH07XHJcbiAgLy8gICB9KTtcclxuICAvLyB9XHJcblxyXG4gIC8vIHJlY2lldmVQcml2YXRlTWVzc2FnZSgpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gIC8vICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKG9ic2VydmVyID0+IHtcclxuICAvLyAgICAgdGhpcy5zb2NrZXQub24oJ3JlY2VpdmUtcHJpdmF0ZS1tZXNzYWdlJywgKGRhdGE6IGFueSkgPT4ge1xyXG4gIC8vICAgICAgIG9ic2VydmVyLm5leHQoZGF0YSk7XHJcbiAgLy8gICAgIH0pO1xyXG4gIC8vICAgICByZXR1cm4gKCkgPT4ge1xyXG4gIC8vICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3NvY2tldEVycm9yS2V5JywgJ1JQTScpO1xyXG4gIC8vICAgICAgIC8vIHRoaXMuc29ja2V0LmRpc2Nvbm5lY3QoKTtcclxuICAvLyAgICAgfTtcclxuICAvLyAgIH0pO1xyXG4gIC8vIH1cclxuXHJcbiAgLy8gcHJpdmF0ZU1lc3NhZ2VBY2tub3dsZWRnZSgpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gIC8vICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKG9ic2VydmVyID0+IHtcclxuICAvLyAgICAgdGhpcy5zb2NrZXQub24oJ3BlcnNvbmFsLW1lc3NhZ2UtYWNrJywgKGRhdGE6IGFueSkgPT4ge1xyXG4gIC8vICAgICAgIG9ic2VydmVyLm5leHQoZGF0YSk7XHJcbiAgLy8gICAgIH0pO1xyXG4gIC8vICAgICByZXR1cm4gKCkgPT4ge1xyXG4gIC8vICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3NvY2tldEVycm9yS2V5JywgJ1BNQScpO1xyXG4gIC8vICAgICAgIC8vIHRoaXMuc29ja2V0LmRpc2Nvbm5lY3QoKTtcclxuICAvLyAgICAgfTtcclxuICAvLyAgIH0pO1xyXG4gIC8vIH1cclxuXHJcbiAgLy8gZ2V0VW5yZWFkTWVzc2FnZXMoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAvLyAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZShvYnNlcnZlciA9PiB7XHJcbiAgLy8gICAgIHRoaXMuc29ja2V0Lm9uKCdnZXQtdW5yZWFkLW1lc3NhZ2VzJywgKGRhdGE6IGFueSkgPT4ge1xyXG4gIC8vICAgICAgIG9ic2VydmVyLm5leHQoZGF0YSk7XHJcbiAgLy8gICAgIH0pO1xyXG4gIC8vICAgICByZXR1cm4gKCkgPT4ge1xyXG4gIC8vICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3NvY2tldEVycm9yS2V5JywgJ0dVTScpO1xyXG4gIC8vICAgICAgIC8vIHRoaXMuc29ja2V0LmRpc2Nvbm5lY3QoKTtcclxuICAvLyAgICAgfTtcclxuICAvLyAgIH0pO1xyXG4gIC8vIH1cclxuXHJcbiAgLy8gcmVhZE1lc3NhZ2VzKHNlbmRlcl9pZDogbnVtYmVyLCByZWNlaXZlcl9pZDogbnVtYmVyKSB7XHJcbiAgLy8gICB0aGlzLnNvY2tldC5lbWl0KCdyZWFkLW1lc3NhZ2VzJywgeyBzZW5kZXJfaWQsIHJlY2VpdmVyX2lkIH0pO1xyXG4gIC8vIH1cclxuXHJcbiAgLy8gb25UeXBlKHBhcmFtOiBhbnkpIHtcclxuICAvLyAgIHRoaXMuc29ja2V0LmVtaXQoJ09uVHlwaW5nJywgcGFyYW0pO1xyXG4gIC8vIH1cclxuXHJcbiAgLy8gaXNUeXBpbmcoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAvLyAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZShvYnNlcnZlciA9PiB7XHJcbiAgLy8gICAgIHRoaXMuc29ja2V0Lm9uKCdpc1R5cGluZycsIChkYXRhOiBhbnkpID0+IHtcclxuICAvLyAgICAgICBvYnNlcnZlci5uZXh0KGRhdGEpO1xyXG4gIC8vICAgICB9KTtcclxuICAvLyAgICAgcmV0dXJuICgpID0+IHtcclxuICAvLyAgICAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKCdzb2NrZXRFcnJvcktleScsICdJVCcpO1xyXG4gIC8vICAgICAgIC8vIHRoaXMuc29ja2V0LmRpc2Nvbm5lY3QoKTtcclxuICAvLyAgICAgfTtcclxuICAvLyAgIH0pO1xyXG4gIC8vIH1cclxuXHJcbiAgLy8gb25SZWNlaXZlclJlYWRzTWVzc2FnZXMoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAvLyAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZShvYnNlcnZlciA9PiB7XHJcbiAgLy8gICAgIHRoaXMuc29ja2V0Lm9uKCdyZWNlaXZlci1yZWFkLW1lc3NhZ2VzJywgKGRhdGE6IGFueSkgPT4ge1xyXG4gIC8vICAgICAgIG9ic2VydmVyLm5leHQoZGF0YSk7XHJcbiAgLy8gICAgIH0pO1xyXG4gIC8vICAgICByZXR1cm4gKCkgPT4ge1xyXG4gIC8vICAgICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oJ3NvY2tldEVycm9yS2V5JywgJ09SUk0nKTtcclxuICAvLyAgICAgICAvLyB0aGlzLnNvY2tldC5kaXNjb25uZWN0KCk7XHJcbiAgLy8gICAgIH07XHJcbiAgLy8gICB9KTtcclxuICAvLyB9XHJcblxyXG4gIC8qY2hhdCBTb2NrZXQgZW5kcyovXHJcblxyXG5cclxuXHJcbiAgLy8gb25EaXNjb25uZWN0KCkge1xyXG4gIC8vICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKG9ic2VydmVyID0+IHtcclxuICAvLyAgICAgdGhpcy5zb2NrZXQub24oJ2Rpc2Nvbm5lY3RlZCcsICgpID0+IHtcclxuICAvLyAgICAgICBvYnNlcnZlci5uZXh0KCdkaXNjb25uZWN0ZWQnKTtcclxuICAvLyAgICAgfSk7XHJcbiAgLy8gICAgIHJldHVybiAoKSA9PiB7XHJcbiAgLy8gICAgICAgdGhpcy5zb2NrZXQuZGlzY29ubmVjdCgpO1xyXG4gIC8vICAgICB9O1xyXG4gIC8vICAgfSk7XHJcbiAgLy8gfVxyXG5cclxuICAvLyBvbk1lc3NhZ2UoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAvLyAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZShvYnNlcnZlciA9PiB7XHJcbiAgLy8gICAgIHRoaXMuc29ja2V0Lm9uKCdyZWNlaXZlX21lc3NhZ2UnLCAoZGF0YTogYW55KSA9PiB7XHJcbiAgLy8gICAgICAgb2JzZXJ2ZXIubmV4dChkYXRhKTtcclxuICAvLyAgICAgfSk7XHJcbiAgLy8gICAgIHJldHVybiAoKSA9PiB7XHJcbiAgLy8gICAgICAgdGhpcy5zb2NrZXQuZGlzY29ubmVjdCgpO1xyXG4gIC8vICAgICB9O1xyXG4gIC8vICAgfSk7XHJcbiAgLy8gfVxyXG5cclxuICAvLyBvblJvb21Ob3RpZmljYXRpb24oKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAvLyAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZShvYnNlcnZlciA9PiB7XHJcbiAgLy8gICAgIHRoaXMuc29ja2V0Lm9uKCdyb29tX25vdGlmaWNhdGlvbicsIChkYXRhOiBhbnkpID0+IHtcclxuICAvLyAgICAgICBvYnNlcnZlci5uZXh0KGRhdGEpO1xyXG4gIC8vICAgICB9KTtcclxuICAvLyAgICAgcmV0dXJuICgpID0+IHtcclxuICAvLyAgICAgICB0aGlzLnNvY2tldC5kaXNjb25uZWN0KCk7XHJcbiAgLy8gICAgIH07XHJcbiAgLy8gICB9KTtcclxuICAvLyB9XHJcblxyXG4gIC8vIHJvb21saXN0VHlwaW5nKCk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgLy8gICByZXR1cm4gbmV3IE9ic2VydmFibGUob2JzZXJ2ZXIgPT4ge1xyXG4gIC8vICAgICB0aGlzLnNvY2tldC5vbigncm9vbWxpc3RfdHlwaW5nJywgKGRhdGE6IGFueSkgPT4ge1xyXG4gIC8vICAgICAgIG9ic2VydmVyLm5leHQoZGF0YSk7XHJcbiAgLy8gICAgIH0pO1xyXG4gIC8vICAgICByZXR1cm4gKCkgPT4ge1xyXG4gIC8vICAgICAgIHRoaXMuc29ja2V0LmRpc2Nvbm5lY3QoKTtcclxuICAvLyAgICAgfTtcclxuICAvLyAgIH0pO1xyXG4gIC8vIH1cclxuXHJcbiAgLy8gb2ZmbGluZVVzZXIoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAvLyAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZShvYnNlcnZlciA9PiB7XHJcbiAgLy8gICAgIHRoaXMuc29ja2V0Lm9uKCdvZmZsaW5lX3VzZXInLCAoZGF0YTogYW55KSA9PiB7XHJcbiAgLy8gICAgICAgb2JzZXJ2ZXIubmV4dChkYXRhKTtcclxuICAvLyAgICAgfSk7XHJcbiAgLy8gICAgIHJldHVybiAoKSA9PiB7XHJcbiAgLy8gICAgICAgdGhpcy5zb2NrZXQuZGlzY29ubmVjdCgpO1xyXG4gIC8vICAgICB9O1xyXG4gIC8vICAgfSk7XHJcbiAgLy8gfVxyXG5cclxuICAvLyBvbkxpbmUoKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAvLyAgIHJldHVybiBuZXcgT2JzZXJ2YWJsZShvYnNlcnZlciA9PiB7XHJcbiAgLy8gICAgIHRoaXMuc29ja2V0Lm9uKCdvbmxpbmVfdXNlcicsIChkYXRhOiBhbnkpID0+IHtcclxuICAvLyAgICAgICBvYnNlcnZlci5uZXh0KGRhdGEpO1xyXG4gIC8vICAgICB9KTtcclxuICAvLyAgICAgcmV0dXJuICgpID0+IHtcclxuICAvLyAgICAgICB0aGlzLnNvY2tldC5kaXNjb25uZWN0KCk7XHJcbiAgLy8gICAgIH07XHJcbiAgLy8gICB9KTtcclxuICAvLyB9XHJcblxyXG4gIC8vIHVwZGF0ZVN0YXR1cyhzdGF0dXM6IGFueSkge1xyXG4gIC8vICAgY29uc29sZS5sb2coJ3JlYWRfc3RhdHVzIDogJywgc3RhdHVzKTtcclxuICAvLyAgIHRoaXMuc29ja2V0LmVtaXQoJ3JlYWRfc3RhdHVzJywgc3RhdHVzKTtcclxuICAvLyB9XHJcbiAgLy8gbWVzc2FnZVN0YXR1cygpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gIC8vICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKG9ic2VydmVyID0+IHtcclxuICAvLyAgICAgdGhpcy5zb2NrZXQub24oJ3JlY2l2ZV9yZWFkX3N0YXR1cycsIChkYXRhOiBhbnkpID0+IHtcclxuICAvLyAgICAgICBvYnNlcnZlci5uZXh0KGRhdGEpO1xyXG4gIC8vICAgICB9KTtcclxuICAvLyAgICAgcmV0dXJuICgpID0+IHtcclxuICAvLyAgICAgICB0aGlzLnNvY2tldC5kaXNjb25uZWN0KCk7XHJcbiAgLy8gICAgIH07XHJcbiAgLy8gICB9KTtcclxuICAvLyB9XHJcbiAgLy8gb25Vc2VyUmVtb3ZlZEZyb21Hcm91cCgpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gIC8vICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKG9ic2VydmVyID0+IHtcclxuICAvLyAgICAgdGhpcy5zb2NrZXQub24oJ3JlbW92ZV9yb29tJywgKGRhdGE6IGFueSkgPT4ge1xyXG4gIC8vICAgICAgIG9ic2VydmVyLm5leHQoZGF0YSk7XHJcbiAgLy8gICAgIH0pO1xyXG4gIC8vICAgICByZXR1cm4gKCkgPT4ge1xyXG4gIC8vICAgICAgIHRoaXMuc29ja2V0LmRpc2Nvbm5lY3QoKTtcclxuICAvLyAgICAgfTtcclxuICAvLyAgIH0pO1xyXG4gIC8vIH1cclxuXHJcbiAgLy8gb25SZW5hbWVHcm91cCgpOiBPYnNlcnZhYmxlPGFueT4ge1xyXG4gIC8vICAgcmV0dXJuIG5ldyBPYnNlcnZhYmxlKG9ic2VydmVyID0+IHtcclxuICAvLyAgICAgdGhpcy5zb2NrZXQub24oJ3JlbmFtZV9ncm91cCcsIChkYXRhOiBhbnkpID0+IHtcclxuICAvLyAgICAgICBvYnNlcnZlci5uZXh0KGRhdGEpO1xyXG4gIC8vICAgICB9KTtcclxuICAvLyAgICAgcmV0dXJuICgpID0+IHtcclxuICAvLyAgICAgICB0aGlzLnNvY2tldC5kaXNjb25uZWN0KCk7XHJcbiAgLy8gICAgIH07XHJcbiAgLy8gICB9KTtcclxuICAvLyB9XHJcblxyXG5cclxuXHJcbiAgLy8gcmVjZWl2ZWROb3RpZmljYXRpb24oKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAvLyAgIGNvbnNvbGUubG9nKCdpc0Nvbm5lY3RlZCcsIHRoaXMuc29ja2V0LmNvbm5lY3RlZCk7XHJcbiAgLy8gICBjb25zb2xlLmxvZygnQ29ubmVjdGlvbiBlc3RhYmxpc2hlZCBpbiBhZGFwdGVyLi4uJyk7XHJcblxyXG4gIC8vICAgaWYgKCF0aGlzLnNvY2tldC5jb25uZWN0ZWQpIHtcclxuICAvLyAgICAgdGhpcy5jb25uZWN0KCk7XHJcbiAgLy8gICB9XHJcbiAgLy8gICByZXR1cm4gbmV3IE9ic2VydmFibGUob2JzZXJ2ZXIgPT4ge1xyXG4gIC8vICAgICB0aGlzLnNvY2tldC5vbigncmVjZWl2ZV9tZXNzYWdlX2RhdGEnLCAoZGF0YTogYW55KSA9PiB7XHJcbiAgLy8gICAgICAgY29uc29sZS5sb2coJ0RhdGEgcmVjZWl2ZWQgaW4gYWRhcHRlci4uLicsIGRhdGEpO1xyXG4gIC8vICAgICAgIG9ic2VydmVyLm5leHQoZGF0YSk7XHJcbiAgLy8gICAgIH0pO1xyXG4gIC8vICAgICByZXR1cm4gKCkgPT4ge1xyXG4gIC8vICAgICAgIHRoaXMuc29ja2V0LmRpc2Nvbm5lY3QoKTtcclxuICAvLyAgICAgfTtcclxuICAvLyAgIH0pO1xyXG4gIC8vIH1cclxufVxyXG4iXX0=